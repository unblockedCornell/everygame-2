
/**
* Gameplay song.
* "Milky Way" from Faster than Light.
*/
const milkyWaySong = [
  [
    [, 0, 240, .01, .09, .2, 1, 2, , , , , , , , , , .5],
    [.1, 0, 120, , .07, .07, 1, 0, , , .5, .01],
    [.8, 0, 240, .01, .4, .2, 1, 2, , , , , , , , , , .5]
  ],
  [
    [
      [, , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , ,],
      [1, , 24, 24, 20, 20, 17, 17, 17, 24, 22, 22, 19, 19, 15, 15, 15, 22, 24, 24, 20, 20, 8, 13, 8, 8, 22, 22, 22, 15, 15, 19, 15, 22, 24, 24, 20, 20, 17, 17, 17, 24, 22, 22, 19, 19, 15, 15, 15, 22, 24, 24, 20, 20, 8, 13, 8, 8, 22, 22, 22, 15, 15, 19, 15, 22],
      [1, , 24, 17, 20, 15, 17, 8, 5, 24, 22, 15, 19, 10, 15, 7, 3, 22, 24, 19, 20, 13, 8, 8, 8, 5, 22, 10, 3, 15, 3, 19, 15, 22, 24, 17, 20, 12, 17, 8, 5, 24, 22, 15, 19, 10, 15, 7, 3, 22, 24, 19, 20, 13, 8, 8, 8, 5, 22, 10, 3, 15, 3, 19, 15, 22]
    ],
    [
      [2, , 20, , , 17, , , 20, , 19, , 17, , 15, , 12, , 17, , , , 12, , , , 15, , , , , , , , 24, , , 17, , , 24, , 22, , 20, , 19, , 15, , 17, , , , 20, , , , 19, , , , 22, , , ,],
      [1, , 24, 24, 20, 20, 17, 17, 17, 24, 22, 22, 19, 19, 15, 15, 15, 22, 24, 24, 20, 20, 8, 13, 8, 8, 22, 22, 22, 15, 15, 19, 15, 22, 24, 24, 20, 20, 17, 17, 17, 24, 22, 22, 19, 19, 15, 15, 15, 22, 24, 24, 20, 20, 8, 13, 8, 8, 22, 22, 22, 15, 15, 19, 15, 22],
      [1, , 24, 17, 20, 15, 17, 8, 5, 24, 22, 15, 19, 10, 15, 7, 3, 22, 24, 19, 20, 13, 8, 8, 8, 5, 22, 10, 3, 15, 3, 19, 15, 22, 24, 17, 20, 12, 17, 8, 5, 24, 22, 15, 19, 10, 15, 7, 3, 22, 24, 19, 20, 13, 8, 8, 8, 5, 22, 10, 3, 15, 3, 19, 15, 22]
    ],
    [
      [2, , 17, , , , , , , , 15, , , , 10, , , , 17, , , , , , 20, , 19, , , , 22, , , , 24, , , , 17, , , , 24, , 22, , 20, , 19, , 17, , , , , , 19, 17, 19, , , , , , , ,],
      [1, , 24, 24, 20, 20, 17, 17, 17, 24, 22, 22, 19, 19, 15, 15, 15, 22, 24, 24, 20, 20, 8, 13, 8, 8, 22, 22, 22, 15, 15, 19, 15, 22, 24, 24, 20, 20, 17, 17, 17, 24, 22, 22, 19, 19, 15, 15, 15, 22, 24, 24, 20, 20, 8, 13, 8, 8, 22, 22, 22, 15, 15, 19, 15, 22],
      [1, , 24, 17, 20, 15, 17, 8, 5, 24, 22, 15, 19, 10, 15, 7, 3, 22, 24, 19, 20, 13, 8, 8, 8, 5, 22, 10, 3, 15, 3, 19, 15, 22, 24, 17, 20, 12, 17, 8, 5, 24, 22, 15, 19, 10, 15, 7, 3, 22, 24, 19, 20, 13, 8, 8, 8, 5, 22, 10, 3, 15, 3, 19, 15, 22]
    ],
    [
      [2, , 24, , 20, , 17, , , 24, 22, , 19, , 15, , , 22, 24, , 22, , , , , , 22, , , 15, , 19, 15, 22, 24, , 20, , 17, , , 24, 22, , 19, , 15, , , 22, 24, , 20, , , , , , 22, , , 15, , 19, 15, 22],
      [1, , 24, 24, 20, 20, 17, 17, 17, 24, 22, 22, 19, 19, 15, 15, 15, 22, 24, 24, 20, 20, 8, 13, 8, 8, 22, 22, 22, 15, 15, 19, 15, 22, 24, 24, 20, 20, 17, 17, 17, 24, 22, 22, 19, 19, 15, 15, 15, 22, 24, 24, 20, 20, 8, 13, 8, 8, 22, 22, 22, 15, 15, 19, 15, 22],
      [1, , 24, 17, 20, 15, 17, 8, 5, 24, 22, 15, 19, 10, 15, 7, 3, 22, 24, 19, 20, 13, 8, 8, 8, 5, 22, 10, 3, 15, 3, 19, 15, 22, 24, 17, 20, 12, 17, 8, 5, 24, 22, 15, 19, 10, 15, 7, 3, 22, 24, 19, 20, 13, 8, 8, 8, 5, 22, 10, 3, 15, 3, 19, 15, 22]
    ]
  ],
  [0, 1, 2, 3], 70
];

/**
* Death song.
* "Wah Wah" sad trombone sound.
*/
const deathSongData = [
  [
    [.9, 0, 240, .01, .09, .2, 1, 2, , , , , , , , , , .5],
    [.2, 0, 120, , .07, .07, 1, 0, , , .5, .01]
  ],
  [
    [
      [, , 27, , 26, , 25, , 24, , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , ,],
      [, , 15, , 14, , 13, , 12, , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , ,],
      [1, , 15, 15, 14, 14, 13, 13, 12, 12, , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , ,]
    ]
  ],
  [0]
];

/**
* Level complete song.
* "Level up" from Pokemon.
*/
const flagpoleSongData = [
  [
    [.9, 0, 240, .01, .09, .2, 1, 2, , , , , , , , , , .5],
    [.2, 0, 120, , .07, .07, 1, 0, , , .5, .01],
    [.9, 0, 240, .01, .4, .2, 1, 2, , , , , , , , , , .5]
  ],
  [
    [
      [, , 1, 1, 1, , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , ,],
      [, , 5, 5, 5, , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , ,],
      [, , 8, 8, 8, , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , ,],
      [2, , , , , , 8, , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , ,],
      [2, , , , , , 12, , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , ,],
      [2, , , , , , 15, , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , ,]
    ]
  ],
  [0]
];

/**
* Reference to background music currently playing.
* Null if no music playing.
* @type {?AudioBufferSourceNode}
*/
let backgroundMusicNode = null;

/**
* Plays the music.
* @param {!Array} songData The song data.
* @param {boolean=} loop Flag to loop the song continuously.
*/
const playMusic = (songData, loop) => {
  const buffer = zzfxM(...songData); // Generate the sample data
  const node = zzfxP(...buffer); // Play the song
  if (loop) {
    stopBackgroundMusic();
    node.loop = true;
    backgroundMusicNode = node;
  }
};

/**
* Stops current background music.
*/
const stopBackgroundMusic = () => {
  if (backgroundMusicNode) {
    backgroundMusicNode.stop();
    backgroundMusicNode = null;
  }
};

/**
 * Toggles background music.
 * If playing, stops.
 * If not, starts.
 */
const toggleBackgroundMusic = () => {
  if (backgroundMusicNode) {
    stopBackgroundMusic();
    localStorage['music-off'] = 't';
  } else {
    playMusic(milkyWaySong, true);
    localStorage.removeItem('music-off');
  }
};
